= Fase 1: Spegnere il controller compromesso
:allow-uri-read: 


Il modulo di gestione del sistema, situato sul retro del controller a sinistra dello slot 8, contiene componenti integrati per la gestione del sistema, nonché porte per la gestione esterna.  Per sostituire un modulo di gestione del sistema danneggiato o sostituire il supporto di avvio, è necessario arrestare e spegnere il controller di destinazione.

Il modulo di gestione del sistema è dotato dei seguenti componenti integrati:

* Supporti di avvio, che consentono la sostituzione dei supporti di avvio senza rimuovere il modulo controller.
* BMC
* Switch di gestione


Il modulo System Management contiene inoltre le seguenti porte per la gestione esterna:

* RJ45 seriale
* USB seriale (tipo C)
* USB Type-A (Ripristino all'avvio)
* Porta di servizio Ethernet RJ45 per l'accesso alla rete e0M e BMC


.Prima di iniziare
* Assicurarsi che tutti gli altri componenti del sistema funzionino correttamente.
* Assicurarsi che il controller partner sia in grado di assumere il controllo dei controller danneggiati.
* Assicurarsi di sostituire il componente guasto con un componente sostitutivo ricevuto da NetApp.


.A proposito di questa attività
Questa procedura utilizza la seguente terminologia:

* Il controller compromesso è il controller su cui si esegue la manutenzione.
* Il controller integro è il partner ha del controller compromesso.




== Fase 1: Spegnere il controller compromesso

Spegnere o sostituire il controller compromesso.

Per arrestare il controller danneggiato, è necessario determinarne lo stato e, se necessario, eseguire un failover di archiviazione del controller in modo che il controller funzionante continui a elaborare i dati dall'archiviazione del controller danneggiato.

.A proposito di questa attività
* Se si dispone di un cluster con più di quattro nodi, è necessario che sia raggiunto il quorum.  Per visualizzare le informazioni del cluster sui nodi, utilizzare `cluster show` comando.  Per maggiori informazioni sul `cluster show` comando, vederelink:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["Visualizza i dettagli a livello di nodo in un cluster ONTAP"^] .
* Se il cluster non è in quorum o se lo stato di integrità o l'idoneità di un qualsiasi controller (diverso dal controller non funzionante) risulta falso, è necessario correggere il problema prima di arrestare il controller non funzionante. Vedere link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["Sincronizzare un nodo con il cluster"^] .


.Fasi
. Se AutoSupport è attivato, eliminare la creazione automatica del caso richiamando un messaggio AutoSupport:
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
Il seguente messaggio AutoSupport elimina la creazione automatica del caso per due ore:

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. Disattivare il ritorno automatico dalla console del controllore non abilitato:
+
`storage failover modify -node impaired-node -auto-giveback-of false`

+

NOTE: Quando vedi _Vuoi disattivare la restituzione automatica?_, inserisci `y` .

+
.. Se si utilizza ONTAP versione 9.17.1 e il controller non funzionante non può essere avviato o è già stato preso in carico, è necessario disattivare il collegamento di interconnessione HA dal controller funzionante prima di avviare il controller non funzionante.  Ciò impedisce al controllore compromesso di eseguire la restituzione automatica.
+
`system ha interconnect link off -node healthy-node -link 0`

+
`system ha interconnect link off -node healthy-node -link 1`

+

NOTE: Se non si utilizza la versione 9.17.1 ONTAP , saltare il passaggio precedente e andare al passaggio 3.



. Portare la centralina danneggiata al prompt DEL CARICATORE:
+
[cols="1,2"]
|===
| Se il controller non utilizzato visualizza... | Quindi... 


 a| 
Il prompt DEL CARICATORE
 a| 
Passare alla fase successiva.



 a| 
Prompt di sistema o prompt della password
 a| 
Prendere il controllo o interrompere il controllo del controllore sano da parte del controllore compromesso:
`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

Il parametro _-halt true_ porta il nodo danneggiato al prompt LOADER.

|===




== Fase 2: Sostituire il modulo di gestione del sistema danneggiato

Sostituire il modulo di gestione del sistema danneggiato.

. Rimuovere il modulo di gestione del sistema:
+

NOTE: Prima di procedere, verificare che la NVRAM sia stata completata. Quando il LED sul modulo NV è spento, il NVRAM viene rimosso. Se il LED lampeggia, attendere l'arresto del lampeggiamento. Se il lampeggiamento continua per più di 5 minuti, contattare il supporto tecnico per assistenza.

+
image::../media/drw_a1k_sys-mgmt_remove_ieops-1384.svg[Sostituire il modulo di gestione del sistema]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[Numero di didascalia 1]
 a| 
Dispositivo di chiusura della camma del modulo di gestione del sistema

|===
+
.. Se non si è già collegati a terra, mettere a terra l'utente.
.. Scollegare i cavi di alimentazione dagli alimentatori.
.. Rimuovere tutti i cavi collegati al modulo di gestione del sistema.  Etichettare i cavi nel punto in cui erano collegati, in modo da poterli ricollegare alle porte corrette quando si reinstalla il modulo.
.. Ruotare il vassoio di gestione dei cavi verso il basso tirando i pulsanti su entrambi i lati all'interno del vassoio di gestione dei cavi, quindi ruotare il vassoio verso il basso.
.. Premere il pulsante CAM sul modulo di gestione del sistema.
.. Ruotare la leva della camma verso il basso fino in fondo.
.. Avvolgere il dito nel foro sulla leva della camma ed estrarre il modulo dal sistema.
.. Posizionare il modulo di gestione del sistema su un tappetino antistatico per accedere al supporto di avvio.


. Spostare il supporto di avvio nel modulo di gestione del sistema sostitutivo:
+
image::../media/drw_a1k_boot_media_remove_replace_ieops-1377.svg[Sostituzione dei supporti di avvio]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[Numero di didascalia 1]
 a| 
Dispositivo di chiusura della camma del modulo di gestione del sistema



 a| 
image::../media/icon_round_2.png[Numero di didascalia 2]
 a| 
Pulsante di blocco dei supporti di avvio



 a| 
image::../media/icon_round_3.png[Numero di didascalia 3]
 a| 
Supporto di boot

|===
+
.. Premere il pulsante blu di blocco dei supporti di avvio nel modulo Gestione sistema non funzionante.
.. Ruotare il supporto di avvio verso l'alto ed estrarlo dallo zoccolo.


. Installare il supporto di avvio nel modulo di gestione del sistema sostitutivo:
+
.. Allineare i bordi del supporto di avvio con l'alloggiamento dello zoccolo, quindi spingerlo delicatamente a squadra nello zoccolo.
.. Ruotare il supporto di avvio verso il basso finché non tocca il pulsante di blocco.
.. Premere il blocco blu e ruotare il supporto di avvio completamente verso il basso e rilasciare il pulsante di blocco blu.


. Installare il modulo di gestione del sistema sostitutivo nel contenitore:
+
.. Allineare i bordi del modulo di gestione del sistema sostitutivo con l'apertura del sistema e spingerlo delicatamente nel modulo controller.
.. Far scorrere delicatamente il modulo nello slot fino a quando il dispositivo di chiusura della camma non inizia a innestarsi con il perno della camma di i/o, quindi ruotare il dispositivo di chiusura della camma completamente verso l'alto per bloccare il modulo in posizione.


. Ruotare il ARM di gestione dei cavi verso l'alto fino alla posizione di chiusura.
. Eseguire il richiamo del modulo Gestione del sistema.




== Passo 3: Riavviare il modulo controller

Riavviare il modulo controller.

. Ricollegare i cavi di alimentazione all'alimentatore.
+
Il sistema si riavvia, in genere al prompt LOADER.

. Immettere _bye_ al prompt del CARICATORE.
. Premere <enter> quando i messaggi della console si interrompono.
+
** Se viene visualizzato il prompt _login_, procedere al passaggio successivo.
** Se non vedi il prompt di accesso, accedi al nodo partner.


. Restituisci solo la radice con l'opzione override-destination-checks:
+
`storage failover giveback -ofnode impaired-node -only-root true -override -destination-checks true`

+

NOTE: Il seguente comando è disponibile solo nel livello di privilegio Modalità diagnostica.  Per ulteriori informazioni sui livelli di privilegio, vederelink:https://docs.netapp.com/us-en/ontap/system-admin/administrative-privilege-levels-concept.html["Comprendere i livelli di privilegio per i comandi CLI ONTAP"^] .

+
In caso di errori, contattare https://support.netapp.com["Supporto NetApp"].

. Attendi 5 minuti dopo il completamento del report di restituzione, quindi controlla gli stati di failover e restituzione:
+
`storage failover show`E `storage failover show-giveback`

+

NOTE: Il seguente comando è disponibile solo nel livello di privilegio Modalità diagnostica.

. Se i collegamenti interconnessi HA sono stati interrotti, ripristinarli:
+
`system ha interconnect link on -node healthy-node -link 0`

+
`system ha interconnect link on -node healthy-node -link 1`

. Riportare la centralina guasta al normale funzionamento restituendo la memoria:
+
`storage failover giveback -ofnode _impaired_node_name_`

. Se la restituzione automatica è stata disabilitata, riabilitarla: `storage failover modify -node local -auto-giveback-of true` .
. Se AutoSupport è attivato, ripristinare/riattivare la creazione automatica dei casi: `system node autosupport invoke -node * -type all -message MAINT=END`.




== Passaggio 4: Installare le licenze e registrare il numero seriale

Quando si sostituisce il modulo di gestione del sistema, il numero di serie del sistema (SSN) del controller cambia.  È necessario installare nuove licenze per il nodo se il nodo danneggiato utilizzava funzionalità ONTAP che richiedono una licenza standard (bloccata sul nodo).  Per le funzionalità con licenze standard, ogni nodo del cluster deve avere la propria chiave per la funzionalità.

.A proposito di questa attività
Fino a quando non vengono installate le chiavi di licenza, le funzionalità che richiedono licenze standard continuano a essere disponibili per il nodo. Tuttavia, se il nodo era l'unico nodo nel cluster con una licenza per la funzione, non sono consentite modifiche di configurazione alla funzione. Inoltre, l'utilizzo di funzioni senza licenza sul nodo potrebbe mettere fuori conformità con il contratto di licenza, pertanto è necessario installare la chiave di licenza sostitutiva sul nodo il prima possibile.

.Prima di iniziare
È richiesto un file di licenza NetApp (NLF) per il nuovo numero di serie del sistema.  Per ulteriori informazioni sui file di licenza NetApp , vederelink:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/ONTAP_9.10.1_and_later_licensing_overview["Panoramica delle licenze ONTAP 9.10.1 e versioni successive"^] .

Hai 90 giorni per installare le chiavi di licenza, dopodiché tutte le vecchie licenze non saranno più valide.  Dopo aver installato una chiave di licenza valida, hai 24 ore di tempo per installare tutte le chiavi prima che termini il periodo di tolleranza.


NOTE: Se inizialmente il sistema eseguiva ONTAP 9.15.1 o versione successiva, utilizzare la procedura documentata inlink:https://kb.netapp.com/on-prem/ontap/OHW/OHW-KBs/Post_Motherboard_Replacement_Process_to_update_Licensing_on_a_AFF_FAS_system["Post-processo di sostituzione della scheda madre per aggiornare la licenza su un sistema AFF/FAS"^] .  Se non sei sicuro della versione iniziale ONTAP per il tuo sistema, consultalink:https://hwu.netapp.com["NetApp Hardware Universe"^] per maggiori informazioni.

.Fasi
. Se sono necessarie nuove chiavi di licenza, procurarsi le chiavi di licenza sostitutive sul https://mysupport.netapp.com/site/global/dashboard["Sito di supporto NetApp"] Nella sezione My Support (supporto personale) sotto Software licensed (licenze software).
+

NOTE: Le nuove chiavi di licenza richieste vengono generate automaticamente e inviate all'indirizzo e-mail in archivio. Se non si riceve l'e-mail contenente le chiavi di licenza entro 30 giorni, contattare il supporto tecnico.

. Installare ciascuna chiave di licenza tramite ONTAP System Manager.
+
Per ulteriori informazioni, consultare link:https://docs.netapp.com/us-en/ontap/task_admin_enable_new_features.html["Abilita nuove funzionalità aggiungendo chiavi di licenza con ONTAP System Manager"^] .

. Rimuovere le vecchie licenze, se necessario:
+
.. Verificare la presenza di licenze inutilizzate: `license clean-up -unused -simulate`
.. Se l'elenco appare corretto, rimuovere le licenze inutilizzate: `license clean-up -unused`


. Registrare il numero di serie del sistema presso il supporto NetApp.
+
** Se AutoSupport è attivato, inviare un messaggio AutoSupport per registrare il numero di serie.
** Se AutoSupport non è attivato, chiamare https://mysupport.netapp.com["Supporto NetApp"] per registrare il numero di serie.






== Fase 5: Restituire il componente guasto a NetApp

Restituire la parte guasta a NetApp, come descritto nelle istruzioni RMA fornite con il kit. Vedere la https://mysupport.netapp.com/site/info/rma["Restituzione e sostituzione delle parti"] pagina per ulteriori informazioni.
